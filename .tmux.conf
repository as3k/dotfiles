##### Core behavior #####

# Faster escape from prefix combos
set -sg escape-time 0

# Improve color support
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",xterm-256color:Tc"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one closes
set -g renumber-windows on

# Keep your current path when splitting or making windows
bind c    new-window    -c "#{pane_current_path}"
bind %    split-window  -h -c "#{pane_current_path}"
bind '"'  split-window  -v -c "#{pane_current_path}"

##### Navigation #####


# Quick window cycling
bind -r C-h previous-window
bind -r C-l next-window


##### Pane Resizing #####

# Repeatable vim-style resizing
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5


##### Mouse and scrolling #####

# Mouse mode on
set -g mouse on

# Better scrolling in copy mode
setw -g mode-keys vi

##### Copy paste that feels normal #####

# Enter copy mode with prefix + [
bind [ copy-mode

# In copy mode, start selection with v, copy with y
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# Paste with prefix + p
bind p paste-buffer

##### Visual polish #####

# Highlight active pane a bit
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour51

# Status bar
set -g status on
set -g status-interval 2
set -g status-style fg=colour250,bg=colour234
set -g message-style fg=colour234,bg=colour51

# Left side of status
set -g status-left-length 50
set -g status-left "#[fg=colour51] #S #[fg=colour244]|"

# Right side of status
set -g status-right-length 100
set -g status-right "#[fg=colour244]%Y-%m-%d #[fg=colour244]%H:%M #[fg=colour244]| #[fg=colour51]#(whoami)"

# Window list
setw -g window-status-format " #I:#W "
setw -g window-status-current-format "#[fg=colour234,bg=colour51] #I:#W #[default]"
setw -g window-status-separator ""

##### Safety and quality of life #####

# Confirm before killing a pane
bind x confirm-before -p "kill-pane? (y/n)" kill-pane

# Reload config quickly
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

##### Smart resize: tmux + Neovim #####

# Resize left
bind -r h if-shell 'tmux display-message -p "#{pane_current_command}" | grep -iq nvim' \
  'send-keys C-w <' \
  'resize-pane -L 5'

# Resize down
bind -r j if-shell 'tmux display-message -p "#{pane_current_command}" | grep -iq nvim' \
  'send-keys C-w -' \
  'resize-pane -D 5'

# Resize up
bind -r k if-shell 'tmux display-message -p "#{pane_current_command}" | grep -iq nvim' \
  'send-keys C-w +' \
  'resize-pane -U 5'

# Resize right
bind -r l if-shell 'tmux display-message -p "#{pane_current_command}" | grep -iq nvim' \
  'send-keys C-w >' \
  'resize-pane -R 5'
